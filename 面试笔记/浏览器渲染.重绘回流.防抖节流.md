## 输入url之后发生了什么

说明:这里假定是浏览器第一次发出该资源的请求,先不考虑缓存问题

1. DNS解析,通过域名找到IP地址

2. 完成TCP三次握手,

3. 浏览器向服务器发送请求

4. 服务器响应,返回资源
5. 浏览器进行渲染

## [浏览器渲染机制](https://www.jianshu.com/p/05eb1b17b298)

1. 当用户输入一个URL时，浏览器就会向服务器发出一个请求，请求URL对应的资源
2. 接受到服务器的响应内容后，浏览器的HTML解析器，会**将HTML文件解析成一棵DOM树**，DOM树的构建是一个深度遍历的过程，当前节点的所有子节点都构建完成以后，才会去构建当前节点的下一个兄弟节点。
3. **将CSS解析成CSSOM树**（CSS Rule Tree）
4. 根据DOM树和CSSOM树，来**构建Render Tree**（渲染树）,注意渲染树，并不等于DOM树，因为一些像head或display:none的东西，就没有必要放在渲染树中了。
5. 有了Render Tree，浏览器已经能知道网页中有哪些节点，各个节点的CSS定义，以及它们的从属关系，下一步操作就是**Layout**,顾名思义，就是**计算出每个节点在屏幕中的位置**。
6. Layout后，浏览器已经知道哪些节点要显示，每个节点的CSS属性是什么，每个节点在屏幕中的位置是哪里，就进入了最后一步**painting**,按照算出来的规则，通过显卡，把内容画到屏幕上。

#### DOM树的构建流程

![img](../notes-images/webp-20220214022652852)

## 回流与重绘

### 回流(即重排)

元素尺寸/结构变化时 会重新渲染页面

#### 会引起回流的操作:

1. 浏览器窗口大小改变时
2. 元素尺寸/位置/内容/字体大小变化时
3. 增删DOM元素或移动其位置时
4. <u>激活CSS伪类时</u>
5. 页面初次加载时
6. 计算 offsetWidth 和 offsetHeight 属性
7. 设置 style 属性的值
8. 内容变化，比如用户在input框中输入文字，文本或者图片大小改变而引起的计算值宽度和高度改变

#### 如何避免回流?

1. 避免频繁操作样式 应当汇总后统一修改
2. 使用class修改样式 而不是操作样式属性
3. 减少DOM操作
4. 虚拟DOM 对虚拟DOM作改变,然后有library计算更新DOM的最优方式

### 重绘

元素样式改变不影响布局时,浏览器使用重绘对元素进行更新,损耗较少

## 防抖与节流

防抖与节流以减少不必要的损耗,限制回流的使用

### 防抖 (任务触发时间间隔超过指定间隔时,才会执行)

#### 实现一个防抖函数

### 节流 (指定时间间隔内只执行一次任务)

将减少一段时间内触发的频率

#### 实现一个节流函数
